<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A study guide for the AWS Certified Developer - Associate (DVA-C02) exam."><meta name=author content="Javier Vanoli"><link href=https://jvanoli.github.io/dva-c02-study-guide/AWS%20Deep%20Dives/AWS%20Identity%20Access%20Management%20%28IAM%29/ rel=canonical><link href=../../Study%20Guide%20and%20Tips/ rel=prev><link href=../AWS%20STS/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.49"><title>AWS Identity Access Management (IAM) - AWS Certified Developer (DVA-C02) Study Guide</title><link rel=stylesheet href=../../assets/stylesheets/main.6f8fc17f.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CIMB+Plex+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Noto Sans";--md-code-font:"IMB Plex Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#aws-identity-access-management-iam class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Certified Developer (DVA-C02) Study Guide" class="md-header__button md-logo" aria-label="AWS Certified Developer (DVA-C02) Study Guide" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Certified Developer (DVA-C02) Study Guide </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> AWS Identity Access Management (IAM) </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=light-blue data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jvanoli/dva-c02-study-guide title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> View in Github </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Certified Developer (DVA-C02) Study Guide" class="md-nav__button md-logo" aria-label="AWS Certified Developer (DVA-C02) Study Guide" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> AWS Certified Developer (DVA-C02) Study Guide </label> <div class=md-nav__source> <a href=https://github.com/jvanoli/dva-c02-study-guide title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> View in Github </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg> <span class=md-ellipsis> AWS Certified Developer (DVA-C02) Study Guide </span> </a> </li> <li class=md-nav__item> <a href=../../Introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../Exam%20Overview/ class=md-nav__link> <span class=md-ellipsis> Exam Overview </span> </a> </li> <li class=md-nav__item> <a href=../../Study%20Guide%20and%20Tips/ class=md-nav__link> <span class=md-ellipsis> Study Guide and Tips </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> AWS Deep Dives </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> AWS Deep Dives </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> AWS Identity Access Management (IAM) </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> AWS Identity Access Management (IAM) </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#iam-identities class=md-nav__link> <span class=md-ellipsis> IAM Identities </span> </a> </li> <li class=md-nav__item> <a href=#iam-policy class=md-nav__link> <span class=md-ellipsis> IAM Policy </span> </a> </li> <li class=md-nav__item> <a href=#iam-policy-structure class=md-nav__link> <span class=md-ellipsis> IAM Policy Structure </span> </a> </li> <li class=md-nav__item> <a href=#identity-based-policy-vs-resource-based-policy class=md-nav__link> <span class=md-ellipsis> Identity-based Policy vs. Resource-based Policy </span> </a> </li> <li class=md-nav__item> <a href=#cross-account-access class=md-nav__link> <span class=md-ellipsis> Cross-account access </span> </a> <nav class=md-nav aria-label="Cross-account access"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cross-account-for-iam-users class=md-nav__link> <span class=md-ellipsis> Cross-account for IAM users </span> </a> <nav class=md-nav aria-label="Cross-account for IAM users"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-is-access-evaluated class=md-nav__link> <span class=md-ellipsis> How is access evaluated? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cross-account-for-iam-roles class=md-nav__link> <span class=md-ellipsis> Cross-account for IAM roles </span> </a> <nav class=md-nav aria-label="Cross-account for IAM roles"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-is-access-evaluated_1 class=md-nav__link> <span class=md-ellipsis> How is access evaluated? </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#iampassrole-permission class=md-nav__link> <span class=md-ellipsis> IAM:PassRole Permission </span> </a> <nav class=md-nav aria-label="IAM:PassRole Permission"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#additional-notes class=md-nav__link> <span class=md-ellipsis> Additional Notes </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../AWS%20STS/ class=md-nav__link> <span class=md-ellipsis> AWS STS </span> </a> </li> <li class=md-nav__item> <a href=../AWS%20Lambda/ class=md-nav__link> <span class=md-ellipsis> AWS Lambda </span> </a> </li> <li class=md-nav__item> <a href=../Amazon%20API%20Gateway/ class=md-nav__link> <span class=md-ellipsis> Amazon API Gateway‬ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#iam-identities class=md-nav__link> <span class=md-ellipsis> IAM Identities </span> </a> </li> <li class=md-nav__item> <a href=#iam-policy class=md-nav__link> <span class=md-ellipsis> IAM Policy </span> </a> </li> <li class=md-nav__item> <a href=#iam-policy-structure class=md-nav__link> <span class=md-ellipsis> IAM Policy Structure </span> </a> </li> <li class=md-nav__item> <a href=#identity-based-policy-vs-resource-based-policy class=md-nav__link> <span class=md-ellipsis> Identity-based Policy vs. Resource-based Policy </span> </a> </li> <li class=md-nav__item> <a href=#cross-account-access class=md-nav__link> <span class=md-ellipsis> Cross-account access </span> </a> <nav class=md-nav aria-label="Cross-account access"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cross-account-for-iam-users class=md-nav__link> <span class=md-ellipsis> Cross-account for IAM users </span> </a> <nav class=md-nav aria-label="Cross-account for IAM users"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-is-access-evaluated class=md-nav__link> <span class=md-ellipsis> How is access evaluated? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cross-account-for-iam-roles class=md-nav__link> <span class=md-ellipsis> Cross-account for IAM roles </span> </a> <nav class=md-nav aria-label="Cross-account for IAM roles"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-is-access-evaluated_1 class=md-nav__link> <span class=md-ellipsis> How is access evaluated? </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#iampassrole-permission class=md-nav__link> <span class=md-ellipsis> IAM:PassRole Permission </span> </a> <nav class=md-nav aria-label="IAM:PassRole Permission"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#additional-notes class=md-nav__link> <span class=md-ellipsis> Additional Notes </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href="https://github.com/jvanoli/dva-c02-study-guide/edit/main/docs/AWS Deep Dives/AWS Identity Access Management (IAM).md" title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <h1 id=aws-identity-access-management-iam>AWS Identity Access Management (IAM)<a class=headerlink href=#aws-identity-access-management-iam title="Permanent link">&para;</a></h1> <p>IAM is the primary tool for controlling and managing access to an AWS account. It sits at the core of AWS security; everything you do with AWS, whether it's creating a Lambda function, uploading a file to an S3 bucket, or something mundane as viewing EC2 instances on the Console, is governed by IAM. It allows you to specify who, which AWS resources, as well as what actions they can and cannot do. These are also known as authentication and authorization.</p> <h2 id=iam-identities>IAM Identities<a class=headerlink href=#iam-identities title="Permanent link">&para;</a></h2> <p>IAM identities handle the authentication aspect of your AWS account. It pertains to any user, application, or group that belongs to your organization.</p> <p><img alt=image-20250106213326444 src=../assets/image-20250106213326444.png></p> <p>An IAM identity can be an IAM User , IAM role , or IAM Group .</p> <p>An <strong>IAM User</strong> represents the user or application who interacts with AWS services. Take note that an IAM user is different from the root user. Although full admin permissions can be given to an IAM user, there are certain actions that only a root user can carry out, such as deleting an AWS account. IAM users are given long-term credentials for accessing AWS services. These credentials can be in the form of a username and password (for console access) or an access key and secret key (for programmatic access). The former is primarily used when logging into the AWS Console, whereas the latter is used when interacting with AWS Services via CLI/API commands.</p> <p>An <strong>IAM role</strong> isn’t intended to be associated with a unique user, rather, it is meant to be assumed by certain AWS Services or a group of external users with common business roles. Unlike IAM users, roles use time-limited security credentials for accessing AWS. When creating a role, you choose a trusted entity. The trusted entity determines who is authorized to assume the IAM role.</p> <p>An IAM role can be assumed by AWS Services to perform actions on your behalf, an IAM user within your account or from an external one, and users federated by identity providers that AWS trusts. Examples of these identity providers are Microsoft Active Directory, Facebook, Google, Amazon, or any IdP that is compatible with OpenID Connect (OIDC) and SAML 2.0.</p> <p><img alt=image-20250107103806963 src=../assets/image-20250107103806963.png></p> <p><strong>IAM Group</strong> is simply a collection of IAM users. The policies attached to an IAM Group are inherited by the IAM users under it. It’s possible to assign an IAM user to multiple groups, but groups cannot be nested (a group within a group). IAM group offers an easy way of managing users in your account. For example, if you have a team of developers that needs access to AWS Lambda, instead of attaching the necessary permission for them individually, you can put the developers together in an IAM Group called ‘Developers’ and associate the Lambda permissions to that group. If a new member joins the team, simply add him/her to the ‘Developers’ IAM group.</p> <h2 id=iam-policy>IAM Policy<a class=headerlink href=#iam-policy title="Permanent link">&para;</a></h2> <p>An IAM identity cannot perform AWS actions without an IAM Policy attached to it unless the resource being accessed allows the IAM Identity to do so. An IAM Policy is what authorizes an IAM user or role to control and access your AWS resources. There are three types of IAM Policies to choose from:</p> <ul> <li>AWS Managed Policies - these are built-in policies that have been constructed to conform to common use cases and job roles. For example, let’s say you’re working as a system administrator, and you have to give your new database administrator the necessary permissions to do his/her job. Rather than figuring out the right permissions, you may simply use the DatabaseAdministrator managed policy, which grants complete access to AWS services necessary to set up and configure AWS database services. AWS Managed Policies cannot be deleted or modified. </li> <li>Customer-managed Policy - this refers to the policies that you manually create in your account.</li> <li>Inline Policy - a policy that is embedded in an IAM Identity. Unlike AWS Managed Policies and Customer-managed Policies, an inline policy does not have its own ARN; thus, it can’t be referenced by other IAM identities. It is scoped to a specific IAM user or role. </li> </ul> <p>References:</p> <ul> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html>https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html</a></li> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html>https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html</a></li> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups.html>https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups.html</a></li> </ul> <h2 id=iam-policy-structure>IAM Policy Structure<a class=headerlink href=#iam-policy-structure title="Permanent link">&para;</a></h2> <p>An IAM Policy is expressed as a JSON document. It is made up of two components: policy-wide information and one or more statements. The policy-wide information is an optional element that is placed on top of the document. It’s usually just a Version element pertaining to the AWS policy language version being used. This element usually has a static value of 2012-10-17 , referring to the release date of the current AWS policy access language.</p> <p>The Statement block is where you add the permissions you need for accessing various AWS services. A policy can have single or multiple statements where each statement is enclosed within a bracket.</p> <p>The following is an example of an IAM Policy.</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=w> </span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;Sid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;AllowFullEC2AccessFromMyNetwork&quot;</span><span class=w> </span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=w> </span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>                </span><span class=s2>&quot;ec2:DescribeInstance*&quot;</span><span class=w> </span>
<span class=w>            </span><span class=p>],</span>
<span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;*&quot;</span><span class=w> </span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Condition&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nt>&quot;IpAddress&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                    </span><span class=nt>&quot;aws:SourceIp&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;180.0.111.0/24&quot;</span><span class=w> </span>
<span class=w>                </span><span class=p>}</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>       </span><span class=p>}</span>
<span class=w>    </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <p>An individual statement has the following elements:</p> <ul> <li><strong><code>Statement ID (Sid)</code></strong> - this is just a label that you give to a statement. It’s helpful for quickly identifying what a statement is for rather than reviewing what’s in the Action , Effect , or Resource . This element is optional; however, it might be useful when modifying or debugging policies with multiple statements.</li> <li><strong><code>Effect</code></strong> - explicitly dictates whether the policy allows or denies access to a given resource. It only accepts an Allow or a Deny .</li> <li><strong><code>Action</code></strong> - this element contains the list of actions that the policy allows or denies. You can use the (<em>) wildcard to grant access to all or a subset of AWS operations. In the example above, the ec2:DescribeInstance</em> refers to all actions that start with the string “DescribeInstance”. So this can be referring to DescribeInstanceAttribute , DescribeInstances , DescribeInstancesStatus , and so on.</li> <li><strong><code>Resource</code></strong> - the list of AWS resources to which the Action element is applied. The example policy above uses a (*) wildcard alone to match all characters. This implies that Action is applicable to all resources. You can be more restrictive to the resources that you want to work with by specifying their Amazon Resource Names (ARN).</li> <li><strong><code>Condition</code></strong> - an optional element that you can use to apply logic to your policy when it’s in effect. For instance, the sample policy above only allows requests originating from the 180.0.111.0/24 network. Some conditions that you should be aware of are:<ul> <li><code>StringEquals</code> - Exact string matching and case-sensitive</li> <li><code>StringNotEquals</code> - Negated matching</li> <li><code>StringLike</code> - Exact matching but ignoring case</li> <li><code>StringNotLike</code> - Negated matching</li> <li><code>Bool</code> - Lets you construct Condition elements that restrict access based on true or false values.</li> <li><code>IpAddress</code> - Matching specified IP address or range.</li> <li><code>NotIpAddress</code> - All IP addresses except the specified IP address or range</li> <li><code>ArnEquals</code>, <code>ArnLike</code></li> <li><code>ArnNotEquals</code>, <code>ArnNotLike</code></li> <li>Use a <code>Null</code> condition operator to check if a condition key is present at the time of authorization.</li> <li>You can add IfExists to the end of any condition operator name (except the <code>Null</code> condition)—for example, <code>StringLikeIfExists</code>.</li> </ul> </li> </ul> <p>References:</p> <ul> <li><a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-policy-structure.html>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-policy-structure.html</a></li> <li><a href=https://aws.amazon.com/blogs/security/back-to-school-understanding-the-iam-policy-grammar/ >https://aws.amazon.com/blogs/security/back-to-school-understanding-the-iam-policy-grammar/</a></li> </ul> <h2 id=identity-based-policy-vs-resource-based-policy>Identity-based Policy vs. Resource-based Policy<a class=headerlink href=#identity-based-policy-vs-resource-based-policy title="Permanent link">&para;</a></h2> <p>There are six types of IAM Policy: <em>Identity-based policies</em>, <em>Resource-based policies</em>, <em>IAM permissions boundaries</em>, <em>Service Control Policies</em>, <em>Session policies</em>, and <em>Access Control Lists (ACLs)</em>. For the purpose of the exam, we will focus only on Identity-based and Resource-based policies. The difference between them is pretty simple. The Identity-based policies are policies you attach to an IAM Identity, such as IAM user or IAM role. On the other hand, resource-based policies are attached to AWS resources, such as an S3 bucket (bucket policy), KMS key (key policy), or a Lambda function. Take note that not all AWS resources support resource-based policies.</p> <p><img alt=image-20250107101715701 src=../assets/image-20250107101715701.png></p> <p>An <strong>Identity-based policy</strong> defines the resources and actions that an IAM user or role has access to. Since the policy is attached to the IAM user or role, the Principal element doesn't need to be explicitly specified. In other words, the IAM user or role that the policy is attached to is implicitly considered the principal. </p> <p>A <strong>Resource-based policy</strong> , on the other hand, must include both the Principal and Resource elements. The Principal element specifies which IAM identities are allowed to access the resource, while the Resource element specifies which resources users are allowed to perform actions on. For example, a bucket policy is a type of resource-based policy that is attached to an Amazon S3 bucket. The policy specifies the actions that are allowed on the bucket and the IAM users or roles that are allowed to perform those actions.</p> <p>The following S3 bucket policy is an example of how the Resource element is used to grant resource-level permissions. You can see that the tdojo S3 bucket contains two folders, john-folder and dave-folder, to which IAM users John and Dave have read access, respectively.</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Principal&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>&quot;AWS&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:iam::123456789000:user/john&quot;</span><span class=p>},</span>
<span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>                </span><span class=s2>&quot;s3:GetObject&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=s2>&quot;s3:GetObjectVersion&quot;</span>
<span class=w>            </span><span class=p>],</span>
<span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>                </span><span class=s2>&quot;arn:aws:s3:::tdojo/john-folder&quot;</span>
<span class=w>            </span><span class=p>]</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Principal&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>&quot;AWS&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:iam::123456789000:user/dave&quot;</span><span class=p>},</span>
<span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>                </span><span class=s2>&quot;s3:GetObject&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=s2>&quot;s3:GetObjectVersion&quot;</span>
<span class=w>            </span><span class=p>],</span>
<span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>                </span><span class=s2>&quot;arn:aws:s3:::tdojo/dave-folder&quot;</span>
<span class=w>            </span><span class=p>]</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <p>An important aspect of IAM that you need to understand is how different policies are evaluated. Before determining whether your request is allowed or not, AWS evaluates all explicit DENY statements first on all policies that are involved. If the requester is specified in a DENY statement in either of the policies, IAM denies the request. Second, between the resource-based and identity-based policies, resource-based policies are evaluated first. For example, an IAM user with an empty IAM policy will still be able to access an S3 bucket as long as its bucket policy allows the IAM user to perform actions on the bucket.</p> <p>Here's a stripped-down version of the AWS flow chart on policy evaluation. Only resource-based and IAM-based policies are included for simplicity.</p> <p><img alt=image-20250107102126016 src=../assets/image-20250107102126016.png></p> <p><strong>References:</strong></p> <ul> <li> <p><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_identity-vs-resource.html>https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_identity-vs-resource.html</a></p> </li> <li> <p><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html>https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html</a></p> </li> </ul> <h2 id=cross-account-access>Cross-account access<a class=headerlink href=#cross-account-access title="Permanent link">&para;</a></h2> <p>The policy evaluation logic discussed in the previous section is for Intra-account access which involves users and AWS resources interacting with each other within the same account. The evaluation of policies is quite different when it comes to cross-account access. </p> <p>Cross-account access refers to access between two or more separate AWS accounts. This could be an EC2 instance in one AWS account accessing an S3 bucket in a different AWS account or a user in one account assuming a role in another account to access resources in that account.</p> <h3 id=cross-account-for-iam-users>Cross-account for IAM users<a class=headerlink href=#cross-account-for-iam-users title="Permanent link">&para;</a></h3> <p>Imagine an IAM User named ‘Tucker’ in Account A who needs to download documents from the <code>private/documents</code> folder of an S3 bucket in Account B.</p> <p>To grant this permission, the following actions must be configured:</p> <ol> <li> <p>In Account B, the S3 bucket owner creates an S3 bucket policy that specifies Tucker is allowed to download the documents. The policy should be attached to the <code>private</code> S3 bucket in Account B.</p> <p><em>Example S3 bucket policy in Account B:</em></p> </li> </ol> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Principal&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>&quot;AWS&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:iam::&lt;Account A ID&gt;:user/Tucker&quot;</span><span class=p>},</span>
<span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;s3:GetObject&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::private/documents/*&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <ol> <li> <p>In Account A, Tucker must have an IAM policy that grants permissions to access the S3 bucket in Account B. The policy allows Tucker to access the S3 bucket without assuming an IAM role.</p> <p><em>Example IAM policy for Tucker in Account A:</em> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;Sid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;DownloadDocuments&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;s3:GetObject&quot;</span><span class=w> </span><span class=p>],</span>
<span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::private/documents/*&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div></p> </li> </ol> <p>After setting up the required permissions in both accounts, Tucker can now use AWS SDK or CLI to access the S3 bucket in Account B and download the documents.</p> <h4 id=how-is-access-evaluated>How is access evaluated?<a class=headerlink href=#how-is-access-evaluated title="Permanent link">&para;</a></h4> <p>If Tucker makes a request to the bucket in Account B, AWS performs two evaluations to determine whether the request is allowed or denied, one in the trusting account (AccountB) and one in the trusted account (AccountA). In Account A, AWS checks the identity-based policy of Tucker and any policies that can limit actions that he’s requesting. In AccountB, AWS evaluates the bucket policy and any policies that can limit the action being requested. The request is only allowed if both evaluations result in a decision of "Allow". If any policy evaluation returns a decision of "Deny", the access request is denied.</p> <h3 id=cross-account-for-iam-roles>Cross-account for IAM roles<a class=headerlink href=#cross-account-for-iam-roles title="Permanent link">&para;</a></h3> <p>Alternatively, an administrator in Account B can create an IAM role for Tucker to assume. This method provides a more scalable and flexible solution, as the administrator can easily modify or revoke access to the S3 bucket as needed. For instance, if there are other IAM users in Account A that need similar access to the bucket, the administrator can simply grant permission for them to assume the IAM role rather than modifying the S3 bucket policy for each user. This approach reduces administrative overhead in granting access to the bucket. </p> <p>Here are the steps for how you might grant any IAM users in Account A to assume an IAM role in Account B.</p> <ol> <li> <p>In Account B, the IAM administrator creates an IAM role with a policy that grants access to the S3 bucket.</p> <p><em>Example S3 bucket policy in Account B:</em></p> </li> </ol> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;Sid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;DownloadDocuments&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;s3:GetObject&quot;</span><span class=p>],</span>
<span class=w>      </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::private/documents/*&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <ol> <li> <p>The IAM administrator must also attach a trust policy to the IAM role, specifying which AWS accounts and entities are allowed to assume the role. In this case, the trust policy must include Account A as a trusted account.</p> <p><em>Example trust policy in Account B (Note that the “</em><em>root</em><em>” refers to any Principals in Account A, excluding the root user):</em></p> </li> </ol> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;Principal&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>&quot;AWS&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:iam::AccountA:root&quot;</span><span class=p>},</span>
<span class=w>      </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sts:AssumeRole&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <ol> <li> <p>The policy for an IAM user in Account A must allow the sts:AssumeRole action on the ARN of the IAM role in Account B.</p> <p><em>Example IAM policy for an IAM user in Account A:</em></p> </li> </ol> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sts:AssumeRole&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:iam::&lt;Account B ID&gt;:role/RoleName&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <h4 id=how-is-access-evaluated_1>How is access evaluated?<a class=headerlink href=#how-is-access-evaluated_1 title="Permanent link">&para;</a></h4> <p>Once the trust policy is evaluated in Account B, AWS verifies whether the IAM user (in Account A) assuming the IAM role is authorized to do so. Once the IAM user assumes the role, AWS checks if the IAM role has sufficient permissions to access the requested resource in the bucket. After that, the S3 bucket policy is evaluated and access will be granted only if all policy evaluations result in a decision of "Allow". </p> <p><strong>References:</strong></p> <ul> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic-cross-account.html>https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic-cross-account.html</a></li> <li><a href=https://aws.amazon.com/blogs/security/how-to-use-trust-policies-with-iam-roles/ >https://aws.amazon.com/blogs/security/how-to-use-trust-policies-with-iam-roles/</a></li> </ul> <h2 id=iampassrole-permission>IAM:PassRole Permission<a class=headerlink href=#iampassrole-permission title="Permanent link">&para;</a></h2> <p>PassRole is a special type of IAM permission that permits a user to associate IAM roles to an AWS resource. This is a simple yet powerful permission that warrants due scrutiny when constructing IAM Policies. You can, for example, use the PassRole permission to prohibit certain IAM users from passing roles that have greater permissions than the user is allowed to have. Let me paint a scenario for you to explain this.</p> <p>Say your company has a Lambda function that processes data stored on Amazon S3. An execution role with full S3 access is attached to the Lambda function. The Lambda function runs per schedule and only admins are authorized to make code changes to it. Even though you don’t have access to the Lambda function, you can bypass the permissions given to you if the following policy is attached to your IAM user.</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;iam:PassRole&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;*&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <p>The preceding IAM policy allows you to pass any IAM roles that exist on your company’s AWS account. This creates a security hole that can be exploited to elevate your access. Given you have enough permissions to create Lambda functions, all you have to do is launch a fresh Lambda function and attach the execution role that has full S3 access. Doing so, even if your IAM user lacks S3 permissions, you’d still be able to access Amazon S3 using the Lambda function.</p> <p><img alt=image-20250107104755473 src=../assets/image-20250107104755473.png></p> <p>For better security, be more granular when it comes to providing access. For example, list the specific IAM roles that a user can pass rather than just using a wildcard, like what’s shown below:</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;iam:PassRole&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=s2>&quot;arn:aws:iam::123456789123:role/td-cloudwatch-agent-role&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=s2>&quot;arn:aws:iam::123456789123:role/td-s3-role&quot;</span>
<span class=w>      </span><span class=p>]</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <p><strong>References:</strong></p> <ul> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_passrole.html>https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_passrole.html</a></li> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_examples_iam-passrole-service.html>https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_examples_iam-passrole-service.html</a></li> </ul> <h3 id=additional-notes>Additional Notes<a class=headerlink href=#additional-notes title="Permanent link">&para;</a></h3> <p>In AWS, Role-Based Access Control (RBAC) is implemented using AWS Identity and Access Management (IAM). RBAC in AWS allows you to define permissions based on roles that align with specific job functions within your organization. Each role has an associated set of permissions specified by IAM policies. These roles can be allocated to anyone, including groups or services, granting them the access they need to carry out their responsibilities. As an example, you can define roles like Admin, Developer, or ReadOnly User, each of which has certain rights that limit what they can do and on which AWS resources. This method simplifies the management of access controls by grouping permissions based on roles rather than managing permissions for each individual user . </p> <p><strong>References:</strong></p> <ul> <li><a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/saas-multitenant-api-access-authorization/access-control-types.html>https://docs.aws.amazon.com/prescriptive-guidance/latest/saas-multitenant-api-access-authorization/access-control-types.html</a></li> </ul> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 15, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 15, 2025</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../Study%20Guide%20and%20Tips/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Study Guide and Tips"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Study Guide and Tips </div> </div> </a> <a href=../AWS%20STS/ class="md-footer__link md-footer__link--next" aria-label="Next: AWS STS"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> AWS STS </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright Javier Vanoli © 2025 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.linkedin.com/in/javiervanoli/ target=_blank rel=noopener title="Find me on LinkedIn!" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.06 2.06 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065m1.782 13.019H3.555V9h3.564zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0z"/></svg> </a> <a href=mailto:jvanoli@dinounou.com target=_blank rel=noopener title="Send me an E-Mail!" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.footer", "navigation.path", "search.share", "search.highlight", "search.suggest", "toc.follow", "content.action.edit"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.88dd0f4e.min.js></script> </body> </html>